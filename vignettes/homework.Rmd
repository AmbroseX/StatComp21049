---
title: "homework"
author: "Rongkang Xiong"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{homework}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(StatComp21049)
```

## The homework 0 2021---09---16

### Question

texts. The 1st example figures. The 2nd example tables. The 3rd example

### Answer

### Example 1

1.italics斜体 *This txt will apper italicized!*

2.old加粗 **This txt will apper italicized!**

3.Headings 标题 \#\# This is a secondary heading 二级标题 \#\#\# This is
a tertiary heading 小标题

4.Unordered Lists 无序数据列 - first item in list - second item in list
- third item in list

5.Ordered Lists 有序数据列 1. first item in list 2. second item in list
3. third item in list

6.Links超链接 [Johns Hopkin Bloomberg School of Public
Health](http://www.jhsph.edu/) Download R

7.Advanced Linking 超链接 I spend so much time reading [R bloggers][1]
and [Simply Statistics][2]! [1]: <http://www.r-bloggers.com/> "R
bloggers" [2]: <http://simplystatistics.org/> "Simply Statistics"

8.Newlines 换行 换行需要在句尾加上双空格

```{r}
plot(1:5, 1:5, xlim = c(0,6), ylim = c (0,6), type = "n")
text(x = 3, y = 3, labels = "R for beginner")
```

```{r}
plot(1:5, 1:5, xlim = c(0,6), ylim = c (0,6), type = "n")
text(x = c(3, 3), y = c(5,3), labels = c("R for beginner", "It's easy to learn"))
```

### Example 2

type = "p": 绘制点，默认值\
type = "l": 绘制线\
type = "b": 同时绘制点和线\
type = "c": 仅绘制参数"b"所示的线\
type = "o": 同时绘制点和线，且线穿过点\
type = "h": 绘制出点到横坐标轴的垂直线\
type = "s": 绘制出阶梯图（先横后纵）\
type = "S": 绘制出阶梯图（先纵后竖）\
type = "n": 作空图

```{r}
x<- c(1:6)
y<- c(1:6)
plot(x,y,main="test",type="p",xlim = c(0,7),ylim = c(0,7))
```

```{r}
x<- c(1:6)
y<- c(1:6)
plot(x,y,main="test",type="l",xlim = c(0,7),ylim = c(0,7))
```

```{r}
x<- c(1:6)
y<- c(1:6)
plot(x,y,main="test",type="b",xlim = c(0,7),ylim = c(0,7))
```

```{r}
x<- c(1:6)
y<- c(1:6)
plot(x,y,main="test",type="c",xlim = c(0,7),ylim = c(0,7))
```

```{r}
x<- c(1:6)
y<- c(1:6)
plot(x,y,main="test",type="o",xlim = c(0,7),ylim = c(0,7))
```

```{r}
x<- c(1:6)
y<- c(1:6)
plot(x,y,main="test",type="h",xlim = c(0,7),ylim = c(0,7))
```

```{r}
x<- c(1:6)
y<- c(1:6)
plot(x,y,main="test",type="s",xlim = c(0,7),ylim = c(0,7))
```

```{r}
x<- c(1:6)
y<- c(1:6)
plot(x,y,main="test",type="S",xlim = c(0,7),ylim = c(0,7))
```

```{r}
x<- c(1:6)
y<- c(1:6)
plot(x,y,main="test",type="n",xlim = c(0,7),ylim = c(0,7))
```

### Example 3

绘制表格

|  姓名  | 学科 | 分数 |
|:------:|:----:|:----:|
|  张三  | 英语 |  80  |
|  李四  | 语文 |  70  |
| 刘老师 | 物理 |  60  |

```{r pressure,echo=FALSE}
x<-c(1,2,3)
y<-c(2,3,5)
table(x,y)
```

------------------------------------------------------------------------


## The homework 1 2021-09-23

### Question

Exercises 3.4, 3.11,3.20(page 94-96,Statistical Computating with R).

### Answer

#### 3.4:

The Rayleigh density [156, Ch. 18] is $$
f(x)=\frac{x}{\sigma^{2}} e^{-x^{2} /\left(2 \sigma^{2}\right)}, \quad x \geq 0, \sigma>0
$$ Develop an algorithm to generate random samples from a Rayleigh(σ)
distribution. Generate Rayleigh(σ) samples for several choices of σ \> 0
and check that the mode of the generated samples is close to the
theoretical mode σ (check the histogram).

解： 取 $\sigma=0.1$

```{r}
rm(list=ls())
0.1->sigma;1e5->n;k<-1;numeric(n)->x
while (k<n) {
  runif(1)->u
  x[k]<-sqrt(2*log(1/u))*sigma; #广义均匀分布和单位均匀分布
  k+1->k
}
hist(x,prob=TRUE,main=expression(f(y)==x/(sigma^2)*exp(-x^2/(2*sigma^2))))
t<-seq(0,0.5,0.01)
lines(t,t/(sigma^2)*exp(-t^2/(2*sigma^2)))
```

取 $\sigma=1$

```{r}
rm(list=ls())
1->sigma;1e5->n;k<-1;numeric(n)->x
while (k<n) {
  runif(1)->u
  x[k]<-sqrt(2*log(1/u))*sigma; #广义均匀分布和单位均匀分布
  k <- k+1
}
hist(x,prob=TRUE,main=expression(f(y)==x/(sigma^2)*exp(-x^2/(2*sigma^2))))
t<-seq(0,6,0.01)
lines(t,t/(sigma^2)*exp(-t^2/(2*sigma^2)))
```

取 $\sigma=10$

```{r}
rm(list=ls())
10->sigma;1e5->n;k<-1;numeric(n)->x
while (k<n) {
  runif(1)->u
  x[k]<-sqrt(2*log(1/u))*sigma; #广义均匀分布和单位均匀分布
  k <- k+1
}
hist(x,prob=TRUE,main=expression(f(y)==x/(sigma^2)*exp(-x^2/(2*sigma^2)),sigma==1))
t<-seq(0,40,0.01)
lines(t,t/(sigma^2)*exp(-t^2/(2*sigma^2)))
```
#### 3.11:

Generate a random sample of size 1000 from a normal location mixture.
The components of the mixture have $N(0, 1)$ and $N(3, 1)$ distributions
with mixing probabilities $p_1$ and $p_2 = 1 − p_1$. Graph the histogram
of the sample with density superimposed, for $p_1 = 0.75$. Repeat with
different values for $p_1$ and observe whether the empirical
distribution of the mixture appears to be bimodal. Make a conjecture
about the values of p1 that produce bimodal mixtures.

解：

```{r}
rm(list=ls())
p<-0.75
n<-1e3;
x1<-rnorm(n,0,1)
x2<-rnorm(n,3,1)
x<-numeric(n)
k=1
while(k<n){
  u<-runif(1)
  if (u<=p) x[k]<-x1[k] else x[k]<-x2[k]
  k+1->k
}
hist(x,prob=TRUE,main=expression(f(x)==p*x1+(1-p)*x2))

```

```{r}
rm(list=ls())
p<-0.6
n<-1e3;
x1<-rnorm(n,0,1)
x2<-rnorm(n,3,1)
x<-numeric(n)
k=1
while(k<n){
  u<-runif(1)
  if (u<=p) x[k]<-x1[k] else x[k]<-x2[k]
  k+1->k
}
hist(x,prob=TRUE,main=expression(f(x)==p*x1+(1-p)*x2))

```

```{r}
rm(list=ls())
p<-0.55
n<-1e3
x1<-rnorm(n,0,1)
x2<-rnorm(n,3,1)
x<-numeric(n)
k=1
while(k<n){
  u<-runif(1)
  if (u<=p) x[k]<-x1[k] else x[k]<-x2[k]
  k+1->k
}
hist(x,prob=TRUE,main=expression(f(x)==p*x1+(1-p)*x2))

```

```{r}
rm(list=ls())
p<-0.5
n<-1e4;
x1<-rnorm(n,0,1)
x2<-rnorm(n,3,1)
x<-numeric(n)
k=1
while(k<n){
  u<-runif(1)
  if (u<=p) x[k]<-x1[k] else x[k]<-x2[k]
  k <- k+1
}
hist(x,prob=TRUE,main=expression(f(x)==p*x1+(1-p)*x2))

```

```{r}
rm(list=ls())
p<-0.45
n<-1e3;
x1<-rnorm(n,0,1)
x2<-rnorm(n,3,1)
x<-numeric(n)
k=1
while(k<n){
  u<-runif(1)
  if (u<=p) x[k]<-x1[k] else x[k]<-x2[k]
  k <- k+1
}
hist(x,prob=TRUE,main=expression(f(x)==p*x1+(1-p)*x2))

```

```{r}
rm(list=ls())
p<-0.4
n<-1e3;
x1<-rnorm(n,0,1)
x2<-rnorm(n,3,1)
x<-numeric(n)
k=1
while(k<n){
  u<-runif(1)
  if (u<=p) x[k]<-x1[k] else x[k]<-x2[k]
  k <- k+1
}
hist(x,prob=TRUE,main=expression(f(x)==p*x1+(1-p)*x2))

```

```{r}
rm(list=ls())
p<-0.35
n<-1e3;
x1<-rnorm(n,0,1)
x2<-rnorm(n,3,1)
x<-numeric(n)
k=1
while(k<n){
  u<-runif(1)
  if (u<=p) x[k]<-x1[k] else x[k]<-x2[k]
  k <- k+1
}
hist(x,prob=TRUE,main=expression(f(x)==p*x1+(1-p)*x2))
```

所以$P\in (0.45-0.55)$左右时，会产生双峰分布

#### 3.20:

A compound Poisson process is a stochastic process $\{X(t), t ≥ 0\}$
that can be represented as the random sum
$X(t) =\sum_{i=1}^{N(t)} Yi, t ≥ 0, where \{N(t), t ≥ 0\}$ is a Poisson
process and $Y_1, Y_2,...$are $iid$ and independent of
$\{N(t), t ≥ 0\}.$ Write a program to simulate a compound
$Poisson(λ)–Gamma \ process (Y \ has \ a \ Gamma\  distribution)$.
Estimate the mean and the variance of $X(10)$ for several choices of the
parameters and compare with the theoretical values. Hint: Show
that$E[X(t)] = λtE[Y1]$ and$Var(X(t)) = λtE[Y_1^{2}]$.

解：\
${Y_i}$是Gamma分布，$N(t)$是泊松过程\
In R, the Gamma distribution with parameters $shape = a$ and $scale = s$
has density
$$f(x)= \frac{1}{s^a\Gamma(a)} x^{a-1} e^{-x/s},\quad x\geq 0, a>0,s>0$$
You can use "rgamma(n,shape=a,scale=s)" to generate n gamma random
numbers.

$$E[X]=\frac{\alpha}{\lambda}=as, \quad \operatorname{Var}(X)=\frac{\alpha}{\lambda^{2}}=as^2 \\
(E[X])^2 = a^2s^2, \quad E[X^2]= Var(X)+(E(X))^2=as^2+a^2s^2
$$

泊松分布 $$P(X=k)=\frac{\lambda^k}{k!}e^{-\lambda},\quad k=0,1,...$$
泊松过程
$$P(X(t)=k)=\frac{(\lambda t)^k}{k!}e^{-\lambda t},\quad k=0,1,...$$ You
can use "rpois(n,lambda)" to generate n Poison random numbers.\
1) Generate n Poison distribution random numbers. 2) Generate n Gamma
distribution random numbers. 3)
根据泊松分布的值Np(t)，对Y的前Np项进行求和作为X(t)的值

画出$Poisson(\lambda)-gamma\ process$

```{r}
rm(list=ls())
lambda.poison<-2
lambda.gamma<-1
a = 1
n<-1e3
Npoison<-numeric(n)
k<-1
while(k<=n){
  Npoison[k]<-rpois(1,lambda.poison*k)
  k <- k+1
}
maxp<- max(Npoison)
Y<-rgamma(maxp,shape = a,scale =1/lambda.gamma)
x<-numeric(n)
k<-1
while(k<=n){
  x[k]<-sum(Y[1:Npoison[k]])
  k+1->k
}
plot(x)
```

(1)对$X(10)$进行模拟计算

```{r}
rm(list=ls())
lambda.poison<-2
lambda.gamma<-1
a = 1
t=10
n<-1e4
k<-1
x<-numeric(n)
while(k<=n){
  Npoison<-rpois(1,lambda.poison*t)
  Y<-rgamma(Npoison,shape = a,scale =1/lambda.gamma)
  x[k]<-sum(Y[1:Npoison])
  k+1->k
}
paste('E[X(10)]=',mean(x))
paste('Var(X(10)=',var(x))
```

理论计算值
$$
E[X(t)]=\lambda t E[Y_1]=10\lambda a/\lambda_{gamma} \\
Var[x]=\lambda t E[Y_1^2]=10\lambda (a+a^2)/\lambda_{gamma}^2
$$

```{r}
rm(list=ls())
lambda.poison<-2
lambda.gamma<-1
a = 1
Ex10<-10*lambda.poison*a/lambda.gamma
Var10<-10*lambda.poison*(a+a^2)/lambda.gamma^2
paste("E[X(10)]=",Ex10,",Var[X(10)]=",Var10)
```

(2)对$X(10)$进行模拟计算

```{r}
rm(list=ls())
lambda.poison<-2
lambda.gamma<-2
a = 1
t=10
n<-1e4
k<-1
x<-numeric(n)
while(k<=n){
  Npoison<-rpois(1,lambda.poison*t)
  Y<-rgamma(Npoison,shape = a,scale =1/lambda.gamma)
  x[k]<-sum(Y[1:Npoison])
  k+1->k
}
paste('E[X(10)]=',mean(x))
paste('Var(X(10)=',var(x))
```

理论计算值： $$
E[X(t)]=\lambda t E[Y_1]=10\lambda a/\lambda_{gamma} \\
Var[x]=\lambda t E[Y_1^2]=10\lambda (a+a^2)/\lambda_{gamma}^2
$$

```{r}
rm(list=ls())
lambda.poison<-2
lambda.gamma<-2
a = 1
Ex10<-10*lambda.poison*a/lambda.gamma
Var10<-10*lambda.poison*(a+a^2)/lambda.gamma^2
paste("E[X(10)]=",Ex10,",Var[X(10)]=",Var10)
```

(3)对$X(10)$进行模拟计算

```{r}
rm(list=ls())
lambda.poison<-5
lambda.gamma<-4
a = 2
t=10
n<-1e4
k<-1
x<-numeric(n)
while(k<=n){
  Npoison<-rpois(1,lambda.poison*t)
  Y<-rgamma(Npoison,shape = a,scale =1/lambda.gamma)
  x[k]<-sum(Y[1:Npoison])
  k+1->k
}
paste('E[X(10)]=',mean(x),'Var(X(10)=',var(x))
```

理论计算值： $$
E[X(t)]=\lambda t E[Y_1]=10\lambda a/\lambda_{gamma} \\
Var[x]=\lambda t E[Y_1^2]=10\lambda (a+a^2)/\lambda_{gamma}^2
$$

```{r}
rm(list=ls())
lambda.poison<-5
lambda.gamma<-4
a = 2
Ex10<-10*lambda.poison*a/lambda.gamma
Var10<-10*lambda.poison*(a+a^2)/lambda.gamma^2
paste("E[X(10)]=",Ex10,",Var[X(10)]=",Var10)
```

------------------------------------------------------------------------
## The homework 2 2021-09-30

### Question

Exercises 5.4, 5.9, 5.13, and 5.14 (pages 149-151, Statistical
Computating with R)

### Answer

#### 5.4

Write a function to compute a Monte Carlo estimate of the
$\operatorname{Beta}(3,3)$ cdf, and use the function to estimate $F(x)$
for $x=0.1,0.2, \ldots, 0.9$. Compare the estimates with the values
returned by the pbeta function in $R$.

解： $Beta(x;a,b)$分布的概率密度函数为
$$
f(x;a,b)=\frac{1}{B(a,b)} x^{a-1}(1-x)^{b-1}
$$
Beta函数定义：

$$
B(a,b)=\int_{0}^{1} t^{a-1}(1-t)^{b-1} d t
$$
$pbeta$的定义：
$$pbeta(x,a,b) =\frac{1}{B(a,b)} \int _0^x t^{a-1}(1-t)^{b-1}dt$$
$$
B(3, 3)=\int_{0}^{1} t^{2}(1-t)^{2} d t
$$
首先我们计算$B(3,3)$的积分估计
$$
B(3,3)=\int_{0}^{1} t^{2}(1-t)^{2} d t=E[t^2(1-t)^2] , \quad t\sim U(0,1)
$$
然后可以计算$pbeta(x,3,3)$的估计
$$
pbeta(x,3,3) =\frac{1}{B(3,3)} \int _0^x t^{2}(1-t)^{2}dt = \frac{x}{B(3,3)}E[t^2(1-t)^2],\quad t\sim U(0,x)
$$

```{r}
m<-1e4;x<-runif(m,min=0,max=1)
theta.hat <- mean(x^2*(1-x)^2)
result = matrix(0,1,2)
result[1,1] = theta.hat
result[1,2] = beta(3,3)
rownames(result) = c("Beta(3,3)")
colnames(result) = c("Estimate", "Theoretical")
result
```

编写求cdf的函数：

```{r}
rm(list=ls())

pbetaCDF <- function(x,a,b) {
  pbetax<-numeric(length(x))
  m<-1e6;
  y<-runif(m,min=0,max=1)
  Beta_a_b <- mean(y^(a-1)*(1-y)^(b-1))
  for(i in 1:length(x)){
    n<-1e6;
    y<-runif(n,min=0,max = x[i])
    Beta_x <- x[i]*mean(y^(a-1)*(1-y)^(b-1))
    pbetax[i] <- Beta_x/Beta_a_b
    }
  return(pbetax)
}
x<-seq(0.1,1,0.1)
y<-pbetaCDF(x,3,3)
print(y)
```

比较自定义函数和pbeta函数

```{r}
x<-seq(0.1,1,0.1)
result = matrix(0,3,length(x))
result[1,1:length(x)] = x
result[2,1:length(x)] = pbetaCDF(x,3,3)
result[3,1:length(x)] = pbeta(x,3,3)
rownames(result) = c("x","pbetaCDF(3,3)","pbeta(x,3,3)")
colnames(result) = c(x)
result
```

#### 5.9

The Rayleigh density $[156,(18.76)]$ is 
$$
f(x)=\frac{x}{\sigma^{2}} e^{-x^{2} /\left(2 \sigma^{2}\right)}, \quad x \geq 0, \sigma>0
$$ 
Implement a function to generate samples from a Rayleigh $(\sigma)$
distribution, using antithetic variables. What is the percent reduction
in variance of $\frac{X+X^{\prime}}{2}$ compared with
$\frac{X_{1}+X_{2}}{2}$ for independent $X_{1}, X_{2} ?$

解： 
$$
\begin{align}
& F(x) = \int_0^x \frac{t}{\sigma^{2}} e^{-t^{2} /\left(2 \sigma^{2}\right)}dt=1-e^{-x^2/{2\sigma^2}} \\
& y=1-e^{-x^2/{2\sigma^2}} \\
&\Rightarrow x =\sigma\sqrt{-2ln(1-y)} \\
& \Rightarrow x' =\sigma\sqrt{-2ln(y)} , \quad y\in[0,1]
\end{align}
$$ 
因此方差 
$$
\begin{align}
E(X) &= \sigma^2\int_0^1 \sqrt{-2ln(1-y)}dy=\sqrt{\frac{\pi}{2}}\sigma \\
E(X') &= \sigma^2\int_0^1 \sqrt{-2ln(y)}dy=\sqrt{\frac{\pi}{2}}\sigma \\
Var(X) & = \sigma^2\int_0^1 (\sqrt{-2ln(1-y)}-\sqrt{\frac{\pi}{2}})^2dy = (2-\frac{\pi}{2})\sigma^2\\
Var(X') &= \sigma^2\int_0^1 (\sqrt{-2ln(y)}-\sqrt{\frac{\pi}{2}})^2dy =(2-\frac{\pi}{2})\sigma^2 \\
Cov(X,X') &= \sigma^2 \int_0^1 (\sqrt{-2ln(1-y)}-\sqrt{\frac{\pi}{2}})(\sqrt{-2ln(y)}-\sqrt{\frac{\pi}{2}})dy\\
Var(\frac{X+X'}{2}) &= (Var(X)+Var({X'})+2Cov(X,X'))/4 \\
&=1-\frac{\pi}{4}+\frac{1}{2}\sigma^2 \int_0^1 (\sqrt{-2ln(1-y)}-\sqrt{\frac{\pi}{2}})(\sqrt{-2ln(y)}-\sqrt{\frac{\pi}{2}})dy
\end{align}
$$ 
